%% This Source Code Form is subject to the terms of the Mozilla Public
%% License, v. 2.0. If a copy of the MPL was not distributed with this
%% file, You can obtain one at http://mozilla.org/MPL/2.0/.

%% Copyright 2015, Travelping GmbH <info@travelping.com>

-module('S1AP_asn1_SUITE').

-compile(export_all).

-include_lib("common_test/include/ct.hrl").
-include("ergw_test_lib.hrl").

%%%===================================================================
%%% API
%%%===================================================================

suite() ->
	[{timetrap,{seconds,30}}].

all() ->
    [test].

do_test(Data) ->
    ct:pal("Data: ~p", [Data]),
    {ok, Msg} = 'S1AP-PDU-Descriptions':decode('S1AP-PDU', Data),
    ct:pal("Msg: ~p", [Msg]),
    ?equal({ok, Data}, 'S1AP-PDU-Descriptions':encode('S1AP-PDU', Msg)),
    ok.

test(_Config) ->
    lists:foreach(fun do_test/1, payload()),
    ok.

%%%===================================================================
%%% Internal functions
%%%===================================================================

%% hexstr2bin from otp/lib/crypto/test/crypto_SUITE.erl
hexstr2bin(S) ->
    list_to_binary(hexstr2list(S)).

hexstr2list([X,Y|T]) ->
    [mkint(X)*16 + mkint(Y) | hexstr2list(T)];
hexstr2list([]) ->
    [].
mkint(C) when $0 =< C, C =< $9 ->
    C - $0;
mkint(C) when $A =< C, C =< $F ->
    C - $A + 10;
mkint(C) when $a =< C, C =< $f ->
    C - $a + 10.

payload() ->
    [hexstr2bin("0011002d000004003b00080062f29700"
		"019300003c400a0380656e6230313933"
		"30004000070000004062f29700894001"
		"40"),
     hexstr2bin("20110024000003003d400903004d4d45"
		"6e6734540069000b000062f297000080"
		"0000040057400101"),
     hexstr2bin("000c406b000005000800020001001a00"
		"434207417208292697409210621304e0"
		"e0c04000210201d011d1271a80802110"
		"01000010810600000000830600000000"
		"000d00000a005c0a003103e5c0349011"
		"034f18a4004300060062f29700010064"
		"40080062f297019300100086400130"),
     hexstr2bin("000b4017000003000000020000000800"
		"020001001a000403075501"),
     hexstr2bin("000d4035000005000000020000000800"
		"020001001a000c0b0756082926974092"
		"106213006440080062f2970193001000"
		"4340060062f2970001"),
     hexstr2bin("000b4038000003000000020000000800"
		"020001001a0025240752004711471147"
		"11471147114711471147111012431441"
		"164fb9b9471045124314f8af"),
     hexstr2bin("000d403d000005000000020000000800"
		"020001001a0014130753104710451243"
		"1441164f184d1a4b1c491e0064400800"
		"62f29701930010004340060062f29700"
		"01"),
     hexstr2bin("000b4025000003000000020000000800"
		"020001001a001211378c43feaf00075d"
		"010005e0e0c04060c1"),
     hexstr2bin("000d403d000005000000020000000800"
		"020001001a0014134748924c2e00075e"
		"23093365250805376804f00064400800"
		"62f29701930010004340060062f29700"
		"01"),
     hexstr2bin("000b401d000003000000020000000800"
		"020001001a000a092763508c86010201"
		"d9"),
     hexstr2bin("000d4049000005000000020000000800"
		"020001001a00201f275f47e94c010201"
		"da281408757332626f6f73740774656c"
		"656b6f6d026465006440080062f29701"
		"930010004340060062f2970001"),
     hexstr2bin("00090080e50000060000000200000008"
		"000200010042000a18061a800060030d"
		"40000018008096000034008090450009"
		"090f807f000164010000008080272074"
		"eedb0207420225062062f29700010050"
		"5201c101090d0361706e046e67345403"
		"636f6d0501c0a89d0a5d010030102291"
		"1f9396fefe7648ffff00ba007a003203"
		"813401005e04fefea06d271480802110"
		"030000108106c0a8b396830600000000"
		"500bf662f297800004c00000021362f2"
		"9700012305f400000002640101006b00"
		"0518000c000000490020067b7f159029"
		"5083c065d41ff65fa34deaf7302e7c6d"
		"2c2406b5d3066407900b"),
     hexstr2bin("00164032000003000000020000000800"
		"020001004a401f1e00e0010198138000"
		"300106260e1f83c3f0787e0f0fc1d7c3"
		"ff2020020380"),
     hexstr2bin("20090022000003000040020000000840"
		"0200010033400f000032400a0a1f7f00"
		"0101d97c4278"),
     hexstr2bin("000d4037000005000000020000000800"
		"020001001a000e0d27ecec888f020743"
		"00035200c2006440080062f297019300"
		"10004340060062f2970001"),
     hexstr2bin("000c4077000005000800020002001a00"
		"4f4e17e4719e8d040741220829269740"
		"9210620304e060c04000240201d031d1"
		"271d8080211001000010810600000000"
		"830600000000000d00000300000a005c"
		"0a003103e5e0349011035758865d0100"
		"004300060062f2970001006440080062"
		"f297019300100086400130"),
     hexstr2bin("000b4017000003000000020001000800"
		"020002001a000403075501"),
     hexstr2bin("000d403b000005000000020001000800"
		"020002001a0012111794570bf8050756"
		"082926974092106203006440080062f2"
		"9701930010004340060062f2970001"),
     hexstr2bin("000b4038000003000000020001000800"
		"020002001a0025240752004711471147"
		"11471147114711471147111012431441"
		"164fb9b9471045124314f8af"),
     hexstr2bin("000d4043000005000000020001000800"
		"020002001a001a1917f2915625060753"
		"1047104512431441164f184d1a4b1c49"
		"1e006440080062f29701930010004340"
		"060062f2970001"),
     hexstr2bin("000b4025000003000000020001000800"
		"020002001a00121137543b868200075d"
		"010005e060c04070c1"),
     hexstr2bin("000d403d000005000000020001000800"
		"020002001a00141347cbf6b2be00075e"
		"23093345510306600006f00064400800"
		"62f29701930010004340060062f29700"
		"01"),
     hexstr2bin("000b401d000003000000020001000800"
		"020002001a000a092763508c86010201"
		"d9"),
     hexstr2bin("000d4042000005000000020001000800"
		"020002001a001918278cc1b0c1010201"
		"da280d0361706e046e67347403636f6d"
		"006440080062f2970193001000434006"
		"0062f2970001"),
     hexstr2bin("00090080ed0000060000000200010008"
		"000200020042000a18061a800060030d"
		"4000001800809e000034008098450009"
		"090f807f00016402000000808827a746"
		"2fa20207420225062062f29700010058"
		"5201c101090d0361706e046e67345403"
		"636f6d0d030000000000000004c0a89d"
		"065d0100301022911f9396fefe7648ff"
		"ff00ba007a003203813401005e04fefe"
		"a06d271480802110030000108106c0a8"
		"b396830600000000500bf662f2978000"
		"04c00000011362f29700012305f40000"
		"0001640101006b000518000c00000049"
		"0020067b7f1590295083c065d41ff65f"
		"a34deaf7302e7c6d2c2406b5d3066407"
		"900b"),
     hexstr2bin("00164062000003000000020001000800"
		"020002004a404f4e026001049c5a0000"
		"6001060e4cda70d1bf8fff1bf8fff1bf"
		"8fff1bf8fff1bf8fff1bf8fff1bf8ffe"
		"fe1ff909103004870ca74a92e4617e80"
		"000000701fc3ff21200000001c27f0ff"
		"c84800000000"),
     hexstr2bin("20090022000003000040020001000840"
		"0200020033400f000032400a0a1f7f00"
		"0101732d832f"),
     hexstr2bin("000d4037000005000000020001000800"
		"020002001a000e0d27ecec888f020743"
		"00035200c2006440080062f297019300"
		"10004340060062f2970001"),
     hexstr2bin("00124015000003000000020000000800"
		"020001000240020280"),
     hexstr2bin("00170010000002006300040000000100"
		"02400120"),
     hexstr2bin("2017000f000002000040020000000840"
		"020001")].
